# [RustyNES](https://vedant416.github.io/RustyNES/)

`RustyNES` is a Nintendo Entertainment System (NES) emulator written in Rust.

Written from scratch in `Rust` `without using any external libraries.`

It is `cross-platform` and can run on Linux, Windows, and in a web browser (using `WebAssembly`).

Runs using very low cpu and memory resources at `stable 60fps` and crisp audio output.

Experience classic NES games like `Super Mario Bros`, `Super Mario Bros 2`, `Super Mario Bros 3`, `Contra`, and many more.

Try it online in your browser: [RustyNES](https://vedant416.github.io/RustyNES/) (Work in progress)

## Screenshots

### Super Mario Bros.

<img src="screenshots/image1.png" width=250> <img src="screenshots/image2.png" width=250>

## Project Structure

- `RustyNES_core`: This is the heart of the emulator, containing the logic that mimics the functionality of the original NES hardware.

- `RustyNES_cli`: This is a command-line interface for the emulator. It uses `RustyNES_core` and SDL2 library to render the emulator output (audio and video) and handle user input.

- `RustyNES_wasm`: This crate compiles `RustyNES_core` to WebAssembly, allowing the emulator to run in a web browser.

- `RustyNES_web_ui`: This is a web interface for the emulator. It uses WebAssembly module generated by `RustyNES_wasm` to run the emulator in a browser environment. (This is a work in progress)

## Keyboard controls

### NES Controller keybindings

| Emulator Button | Keyboard Key           |
| --------------- | ---------------------- |
| Up              | <kbd>W</kbd>           |
| Left            | <kbd>A</kbd>           |
| Down            | <kbd>S</kbd>           |
| Right           | <kbd>D</kbd>           |
| A               | <kbd>L</kbd>           |
| B               | <kbd>K</kbd>           |
| Start           | <kbd>Enter</kbd>       |
| Select          | <kbd>Right Shift</kbd> |

### Extra Features keybindings (Not in the original NES)

For now saving state feature is only available on the `cli` version of the emulator.

| Action              | Key          |
| ------------------- | ------------ |
| Save emulator state | <kbd>N</kbd> |
| Load emulator state | <kbd>M</kbd> |

Emulator state is saved in a `.rustynes_sav` file.

## Mappers

Mappers implemented:

- Mapper 0 (NROM)
- Mapper 2 (UNROM)
- Mapper4 (MMC3)

## Building

`RustyNES_core` library crate has zero dependencies, but `RustyNES_cli` uses [SDL2](https://www.libsdl.org/) for rendering and input handling.
Ensure that SDL2 is installed on your system for building the `RustyNES_cli`.

### Building for Linux

```bash
cargo build --release
```

`rusty_nes_cli` executable will be in `target/release` directory.

Pass path to the ROM file as an argument to the executable.

```bash
./rusty_nes_cli <path_to_rom_file>
```

To load a save file (`.rustynes_sav`) pass the path to the save file as an argument.

```bash
./rusty_nes_cli <path_to_save_file>
```

### Cross-compiling to Windows

#### Add the Rust target for Windows

```bash
rustup target add x86_64-pc-windows-gnu
```

#### Install mingw-w64

```bash
sudo apt install mingw-w64
```

#### Build the project to Windows

```bash
cargo build --release --target=x86_64-pc-windows-gnu
```

After building `rusty_nes_cli.exe` executable will be in `target/x86_64-pc-windows-gnu/release` directory
and `SDL2.dll` file will be in project root directory.

For running the emulator on Windows, `SDL2.dll` file is required in the same directory as the executable.

Pass path to the ROM file as an argument to the executable.

```bash
rusty_nes_cli.exe <path_to_rom_file>
```

### Building for Web

Install `wasm-pack`:

```bash
cargo install wasm-pack
```

In `RustyNES_web_ui` directory run:

```bash
npm install
npm run dev
```

This will build the RustyNES_wasm lib which will output the WebAssembly file and JavaScript bindings to the `RustyNES_web_ui/public/pkg` directory.

## Resources

### Documentation

- [NES Documentation (PDF)](http://nesdev.com/NESDoc.pdf)
- [Nesdev Wiki](https://www.nesdev.org/wiki/Nesdev_Wiki)
- [6502 CPU Reference 1](https://www.c64os.com/post/?p=39)
- [6502 CPU Reference 2](https://www.masswerk.at/6502/6502_instruction_set.html)
- [NES Rendering Overview](https://austinmorlan.com/posts/nes_rendering_overview/)

### Videos

- [The NES Explained] YouTube playlist by [NesHacker]
- [NES Emulator from Scratch] YouTube playlist by [OneLoneCoder]

[NES Emulator from Scratch]: https://www.youtube.com/playlist?list=PLrOv9FMX8xJHqMvSGB_9G9nZZ_4IgteYf
[The NES Explained]: https://youtube.com/playlist?list=PLgvDB6LWam2VDGPgUAMTEEMk0PUtCJs-n&si=Qoquh5uNFiug1iWz
[OneLoneCoder]: https://www.youtube.com/@javidx9
[NesHacker]: https://www.youtube.com/@NesHacker

### Code

- [github.com//zeta0134/rusticnes-sdl](https://github.com/zeta0134/rusticnes-sdl)
- [github.com/OneLoneCoder/olcNES](https://github.com/OneLoneCoder/olcNES)
- [github.com/marethyu/nesty](https://github.com/marethyu/nesty)
- [github.com/takahirox/nes-rust](https://github.com/takahirox/nes-rust)
- [github.com/nathsou/nessy](https://github.com/nathsou/nessy)
- [github.com/fogleman/nes](https://github.com/fogleman/nes)
- [github.com/maxpoletaev/dendy](https://github.com/maxpoletaev/dendy/)
- [github.com/scottferg/Fergulator](https://github.com/scottferg/Fergulator/)
- [github.com/ltriant/nes](https://github.com/ltriant/nes)
- [github.com/spieglt/nestur](https://github.com/spieglt/nestur)
