(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))o(r);new MutationObserver(r=>{for(const s of r)if(s.type==="childList")for(const i of s.addedNodes)i.tagName==="LINK"&&i.rel==="modulepreload"&&o(i)}).observe(document,{childList:!0,subtree:!0});function n(r){const s={};return r.integrity&&(s.integrity=r.integrity),r.referrerPolicy&&(s.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?s.credentials="include":r.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function o(r){if(r.ep)return;r.ep=!0;const s=n(r);fetch(r.href,s)}})();let a;const f=new Array(128).fill(void 0);f.push(void 0,null,!0,!1);function O(e){return f[e]}let w=f.length;function D(e){e<132||(f[e]=w,w=e)}function R(e){const t=O(e);return D(e),t}const T=typeof TextDecoder<"u"?new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0}):{decode:()=>{throw Error("TextDecoder not available")}};typeof TextDecoder<"u"&&T.decode();let d=null;function b(){return(d===null||d.byteLength===0)&&(d=new Uint8Array(a.memory.buffer)),d}function E(e,t){return e=e>>>0,T.decode(b().subarray(e,e+t))}let y=0;function S(e,t){const n=t(e.length*1,1)>>>0;return b().set(e,n/1),y=e.length,n}function F(e){w===f.length&&f.push(f.length+1);const t=w;return w=f[t],f[t]=e,t}const g=typeof TextEncoder<"u"?new TextEncoder("utf-8"):{encode:()=>{throw Error("TextEncoder not available")}},U=typeof g.encodeInto=="function"?function(e,t){return g.encodeInto(e,t)}:function(e,t){const n=g.encode(e);return t.set(n),{read:e.length,written:n.length}};function j(e,t,n){if(n===void 0){const c=g.encode(e),u=t(c.length,1)>>>0;return b().subarray(u,u+c.length).set(c),y=c.length,u}let o=e.length,r=t(o,1)>>>0;const s=b();let i=0;for(;i<o;i++){const c=e.charCodeAt(i);if(c>127)break;s[r+i]=c}if(i!==o){i!==0&&(e=e.slice(i)),r=n(r,o,o=i+e.length*3,1)>>>0;const c=b().subarray(r+i,r+o),u=U(e,c);i+=u.written,r=n(r,o,i,1)>>>0}return y=i,r}let l=null;function L(){return(l===null||l.byteLength===0)&&(l=new Int32Array(a.memory.buffer)),l}const x=typeof FinalizationRegistry>"u"?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(e=>a.__wbg_nes_free(e>>>0));class p{static __wrap(t){t=t>>>0;const n=Object.create(p.prototype);return n.__wbg_ptr=t,x.register(n,n.__wbg_ptr,n),n}__destroy_into_raw(){const t=this.__wbg_ptr;return this.__wbg_ptr=0,x.unregister(this),t}free(){const t=this.__destroy_into_raw();a.__wbg_nes_free(t)}static new_nes(t){const n=S(t,a.__wbindgen_malloc),o=y,r=a.nes_new_nes(n,o);return p.__wrap(r)}step(){a.nes_step(this.__wbg_ptr)}frame_buffer_pointer(){return a.nes_frame_buffer_pointer(this.__wbg_ptr)>>>0}update_button(t,n){a.nes_update_button(this.__wbg_ptr,t,n)}}async function k(e,t){if(typeof Response=="function"&&e instanceof Response){if(typeof WebAssembly.instantiateStreaming=="function")try{return await WebAssembly.instantiateStreaming(e,t)}catch(o){if(e.headers.get("Content-Type")!="application/wasm")console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",o);else throw o}const n=await e.arrayBuffer();return await WebAssembly.instantiate(n,t)}else{const n=await WebAssembly.instantiate(e,t);return n instanceof WebAssembly.Instance?{instance:n,module:e}:n}}function C(){const e={};return e.wbg={},e.wbg.__wbg_new_abda76e883ba8a5f=function(){const t=new Error;return F(t)},e.wbg.__wbg_stack_658279fe44541cf6=function(t,n){const o=O(n).stack,r=j(o,a.__wbindgen_malloc,a.__wbindgen_realloc),s=y;L()[t/4+1]=s,L()[t/4+0]=r},e.wbg.__wbg_error_f851667af71bcfc6=function(t,n){let o,r;try{o=t,r=n,console.error(E(t,n))}finally{a.__wbindgen_free(o,r,1)}},e.wbg.__wbindgen_object_drop_ref=function(t){R(t)},e.wbg.__wbindgen_throw=function(t,n){throw new Error(E(t,n))},e}function q(e,t){return a=e.exports,v.__wbindgen_wasm_module=t,l=null,d=null,a}async function v(e){if(a!==void 0)return a;typeof e>"u"&&(e=new URL("/rustynes/pkg/rusty_nes_wasm_bg.wasm",import.meta.url));const t=C();(typeof e=="string"||typeof Request=="function"&&e instanceof Request||typeof URL=="function"&&e instanceof URL)&&(e=fetch(e));const{instance:n,module:o}=await k(await e,t);return q(n,o)}document.addEventListener("DOMContentLoaded",z);function z(){const e={l:0,k:1,Shift:2,Enter:3,w:4,s:5,a:6,d:7},t=document.querySelector("#screen"),n=t.getContext("2d"),o=n.createImageData(256,240);t.width=256,t.height=240;const r=()=>{const s=Math.min(window.innerWidth/256,window.innerHeight/240);t.style.width=`${256*s}px`,t.style.height=`${240*s}px`};r(),window.addEventListener("resize",r),(async()=>{let s=await v();const c=await(await fetch("roms/mario.nes")).arrayBuffer(),u=new Uint8Array(c),m=p.new_nes(u),M=256*240*4,W=m.frame_buffer_pointer();window.addEventListener("keydown",_=>A(_,!0)),window.addEventListener("keyup",_=>A(_,!1)),h();function h(){m.step(),o.data.set(new Uint8ClampedArray(s.memory.buffer,W,M)),n.putImageData(o,0,0),requestAnimationFrame(h)}function A(_,I){_.key in e&&(_.preventDefault(),m.update_button(e[_.key],I))}})()}
